<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WH PREMIUM SHOP</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --gold: #D4AF37; --white-soft: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; transition: 0.4s; overflow-x: hidden; }
        body.gold-theme { background: #050505; color: #eee; }
        body.white-theme { background: var(--white-soft); color: #333; }
        .top-bar { display: flex; justify-content: space-between; padding: 5px; align-items: center; }
        .theme-btn { background: none; border: 1px solid currentColor; color: inherit; padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; }
        .shop-header { text-align: center; padding: 15px 0; color: var(--gold); }
        .search-container { padding: 10px; display: flex; justify-content: center; }
        #searchInput { width: 90%; padding: 12px 20px; border-radius: 25px; border: 1px solid rgba(212,175,55,0.3); background: rgba(255,255,255,0.05); color: inherit; outline: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 5px; }
        /* á€•á€…á€¹á€…á€Šá€ºá€¸ Card á€Šá€®á€¡á€±á€¬á€„á€º á€•á€¼á€„á€ºá€†á€„á€ºá€á€»á€€á€º */
        .card { border-radius: 18px; padding-bottom: 12px; text-align: left; overflow: hidden; display: flex; flex-direction: column; transition: 0.3s; }
        .gold-theme .card { background: #121212; border: 1px solid rgba(212,175,55,0.1); }
        .white-theme .card { background: #fff; border: 1px solid #eee; }
        .img-box { width: 100%; aspect-ratio: 1/1; position: relative; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .play-badge { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 10px; border-radius: 20px; font-size: 0.65rem; }
        .card-info { padding: 10px; flex-grow: 1; }
        .card h3 { font-size: 0.85rem; margin: 0 0 5px 0; height: 35px; overflow: hidden; }
        .price { font-weight: 800; font-size: 1.05rem; color: var(--gold); }
        .btn-main { border: none; width: 90%; padding: 10px 0; border-radius: 12px; font-weight: bold; cursor: pointer; display: block; margin: 8px auto; text-align: center; text-decoration: none; }
        .gold-theme .btn-main { background: linear-gradient(135deg, var(--gold), #AA771C); color: #000; }
        .white-theme .btn-main { background: #1a1a1a; color: #fff; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { padding: 30px; border-radius: 30px; width: 85%; max-width: 320px; text-align: center; border: 1px solid var(--gold); }
        .gold-theme .modal-content { background: #1a1a1a; color: #fff; }
        .white-theme .modal-content { background: #fff; color: #333; }
        input { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 12px; border: 1px solid #444; background: rgba(255,255,255,0.05); color: inherit; box-sizing: border-box; outline: none; }
        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000; padding: 12px 25px; border-radius: 50px; font-weight: bold; transition: 0.5s; z-index: 10000; }
        .v-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; align-items: center; justify-content: center; }
    </style>
</head>
<body class="gold-theme" id="bodyTag">

    <div id="toast"></div>

    <div class="top-bar">
        <button class="theme-btn" onclick="openModal('checkModal')">ğŸ” á€™á€¾á€¬á€šá€°á€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸</button>
        <button class="theme-btn" onclick="toggleTheme()" id="tBtn">âšª á€¡á€”á€¯á€–á€¼á€°á€•á€¼á€±á€¬á€„á€ºá€¸á€™á€Šá€º</button>
    </div>

    <div class="shop-header"><h2>WH PREMIUM SHOP</h2></div>

    <div class="search-container">
        <input type="text" id="searchInput" onkeyup="searchProduct()" placeholder="ğŸ” á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá€–á€¼á€„á€·á€º á€›á€¾á€¬á€•á€«...">
    </div>

    <div class="grid" id="productList"></div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold);">ğŸ“‹ á€™á€¾á€¬á€šá€°á€›á€”á€º</h3>
            <div id="orderSummary" style="margin-bottom:15px; font-size:0.9rem;"></div>
            <input type="text" id="custN" placeholder="ğŸ‘¤ á€á€„á€·á€ºá€¡á€™á€Šá€º">
            <input type="number" id="custP" placeholder="ğŸ“ á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
            <input type="text" id="custA" placeholder="ğŸ“ á€œá€­á€•á€ºá€…á€¬">
            <button class="btn-main" onclick="submitOrder()">âœ… á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º</button>
            <div style="margin:10px 0; opacity:0.5;">- OR -</div>
            <a href="viber://chat?number=+959402414331" class="btn-main" style="background:#7360f2 !important; color:#fff !important;">ğŸ’¬ Viber á€™á€¾ á€™á€¾á€¬á€šá€°á€™á€Šá€º</a>
            <button onclick="closeModal('orderModal')" style="background:none; border:none; color:inherit; margin-top:15px; opacity:0.6;">á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <div id="checkModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold);">ğŸ” á€™á€¾á€¬á€šá€°á€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
            <input type="number" id="checkPhone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«">
            <button class="btn-main" onclick="fetchOrders()">á€…á€…á€ºá€†á€±á€¸á€™á€Šá€º</button>
            <div id="orderResult" style="margin-top:15px; max-height:200px; overflow-y:auto; text-align:left; font-size:0.85rem;"></div>
            <button onclick="closeModal('checkModal')" style="background:none; border:none; color:inherit; margin-top:15px; opacity:0.6;">á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <div id="videoModal" class="v-modal">
        <span onclick="closeVideo()" style="position:absolute; top:20px; right:20px; color:#fff; font-size:2.5rem; cursor:pointer;">&times;</span>
        <div id="videoContainer" style="width:100%"></div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyBU4Q9G2eyigNWyZVT_dabEFG4fuslwTW4", 
            authDomain: "online-shop-wh.firebaseapp.com", 
            projectId: "online-shop-wh", 
            storageBucket: "online-shop-wh.firebasestorage.app", 
            messagingSenderId: "297839145890", 
            appId: "1:297839145890:web:f90f862b000e8631a4f8fb" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let selP = "", selPrice = "";

        function showToast(txt) { const t = document.getElementById('toast'); t.innerText = txt; t.style.top = '30px'; setTimeout(() => t.style.top = '-100px', 3000); }
        
        function toggleTheme() { 
            const b = document.getElementById('bodyTag'), t = document.getElementById('tBtn'); 
            if(b.classList.contains('gold-theme')) { b.classList.replace('gold-theme','white-theme'); t.innerText="ğŸŸ¡ á€›á€½á€¾á€±á€›á€±á€¬á€„á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€™á€Šá€º"; } 
            else { b.classList.replace('white-theme','gold-theme'); t.innerText="âšª á€¡á€”á€¯á€–á€¼á€°á€•á€¼á€±á€¬á€„á€ºá€¸á€™á€Šá€º"; } 
        }

        db.collection("products").onSnapshot(s => {
            let l = document.getElementById('productList'); l.innerHTML = "";
            s.forEach(d => {
                let p = d.data();
                let card = document.createElement('div');
                card.className = "card";
                card.innerHTML = `
                    <div class="img-box">
                        <img src="${p.image_url}">
                        ${p.video_id ? `<div class="play-badge" onclick="event.stopPropagation(); playVideo('${p.video_id}')">â–¶ á€—á€®á€’á€®á€šá€­á€¯</div>` : ""}
                    </div>
                    <div class="card-info">
                        <h3>${p.name}</h3>
                        <div class="price">${p.price} Ks</div>
                    </div>
                `;
                let btn = document.createElement('button');
                btn.className = "btn-main"; btn.innerText = "á€á€šá€ºá€šá€°á€™á€Šá€º";
                btn.onclick = () => { selP = p.name; selPrice = p.price; document.getElementById('orderSummary').innerHTML = `ğŸ“¦ <b>${p.name}</b><br>ğŸ’° <b>${p.price} Ks</b>`; openModal('orderModal'); };
                card.appendChild(btn);
                l.appendChild(card);
            });
        });

        function submitOrder() {
    const n = document.getElementById('custN'), 
          ph = document.getElementById('custP'), 
          a = document.getElementById('custA');

    if(n.value && ph.value && a.value) {
        db.collection("orders").add({ 
            product: selP, 
            price: selPrice, 
            customer: n.value, 
            phone: ph.value, 
            address: a.value, 
            time: new Date().toLocaleString() 
        })
        .then(() => { 
            closeModal('orderModal'); 
            showToast("âœ… á€™á€¾á€¬á€šá€°á€™á€¾á€¯ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€º!");
            
            // --- á€’á€®á€¡á€•á€­á€¯á€„á€ºá€¸á€œá€±á€¸ á€‘á€•á€ºá€‘á€Šá€·á€ºá€•á€±á€¸á€•á€« á€†á€›á€¬ ---
            n.value = "";  // á€¡á€™á€Šá€ºá€€á€­á€¯ á€–á€»á€€á€ºá€™á€šá€º
            ph.value = ""; // á€–á€¯á€”á€ºá€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€šá€º
            a.value = "";  // á€œá€­á€•á€ºá€…á€¬á€€á€­á€¯ á€–á€»á€€á€ºá€™á€šá€º
            // ----------------------------------
        });
    } else { 
        showToast("âš ï¸ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€–á€¼á€Šá€·á€ºá€•á€«"); 
    }
}


        function fetchOrders() {
            const ph = document.getElementById('checkPhone').value;
            if(!ph) return showToast("âš ï¸ á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€ºá€‘á€Šá€·á€ºá€•á€«");
            db.collection("orders").where("phone", "==", ph).get().then(s => {
                let h = ""; s.forEach(d => { let o = d.data(); h += `<div style="padding:10px; border-bottom:1px solid #444;">ğŸ“¦ ${o.product}<br><small>${o.time}</small></div>`; });
                document.getElementById('orderResult').innerHTML = h || "á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€•á€«á‹";
            });
        }

        function searchProduct() {
            let input = document.getElementById('searchInput').value.toUpperCase(), cards = document.getElementsByClassName('card');
            for (let i = 0; i < cards.length; i++) { 
                let txt = cards[i].getElementsByTagName('h3')[0].innerText;
                cards[i].style.display = txt.toUpperCase().indexOf(input) > -1 ? "" : "none";
            }
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function playVideo(url) { document.getElementById('videoContainer').innerHTML = `<video controls autoplay loop style="width:100%"><source src="${url}" type="video/mp4"></video>`; document.getElementById('videoModal').style.display = 'flex'; }
        function closeVideo() { document.getElementById('videoModal').style.display = 'none'; document.getElementById('videoContainer').innerHTML = ""; }
    </script>
</body>
</html>
